# Ajax

Ajax被认为是(Asynchronous JavaScript and XML的缩写）。现在，允许浏览器与服务器通信而无须刷新当前页面的技术都被叫做Ajax.

## 不用刷新整个页面便可与服务器通讯的办法：

- Flash
- Java applet
- 框架：如果使用一组框架构造了一个网页，可以只更新其中一个框架，而不必惊动整个页面
- 隐藏的iframe
- **XMLHttpRequest**：该对象是对 JavaScript 的一个扩展，可使网页与服务器进行通信。是创建 Ajax 应用的最佳选择。实际上**通常把 Ajax 当成 XMLHttpRequest 对象的代名词**

![Ajax的工作原理图](pic/Snipaste_2019-03-19_14-32-35.png)

## Ajax工具包

Ajax并不是一项新技术，它实际上是几种技术，每种技术各尽其职，以一种全新的方式聚合在一起
- 服务器端语言：服务器需要具备向浏览器发送特定信息的能力。Ajax与服务器端语言无关。
- XML (eXtensible Markup Language，可扩展标记语言) 是一种描述数据的格式。Aajx 程序需要某种格式化的格式来在服务器和客户端之间传递信息，XML 是其中的一种选择
- XHTML（eXtended Hypertext Markup Language,使用扩展超媒体标记语言）和 CSS（Cascading Style Sheet,级联样式单）标准化呈现；
- DOM（Document Object Model,文档对象模型）实现动态显示和交互；
使用XMLHTTP组件XMLHttpRequest对象进行异步数据读取
使用JavaScript绑定和处理所有数据

## XMLHttpRequest的概述

### XMLHttpRequest中的方法

|方法|描述|
|---|---|
|abort()|停止当前请求|
|getAllResponseHeaders()|把HTTP请求的所有相应首部作为键值对返回|
|getResponseHeader("header")|返回指定首部的串值|
|**open("method","url")**|建立对服务器的调用，Method参数可以是GET，POST etc. url可以是相对路径或者绝对路径|
|**send(content)**|向服务器发送请求|
|*setRequestHeader("header","value")*|把指定首部设置为所提供的值，在设置任何首部之前必须先调用open()|

### XMLHttpRequest的属性

|属性|描述|
|---|---|
|onreadystatechange|每个状态改变时都会触发这个事件处理器，通常会调用一个javaScript函数|
|readyState|请求的状态，5个可取值：0 未初始化，1 正在加载，2 已经加载，3 交互中，4 完成|
|responseText|服务器的响应，表示一个串|
|responseXML|服务器的相应，表示为XML。这个对象可以解析为DOM对象|
|status|服务器的HTTP状态码（200对应OK）|
|statusText|HTTP状态码的相应文本（OK或NotFound）|

## 案例

![](pic/Snipaste_2019-03-19_16-29-18.png)

```jsp
<%@ page pageEncoding="UTF-8" %>
<html>
<head>
    <title>Title</title>
</head>
<script charset="UTF-8" type="text/javascript">
    window.onload = function () {

        // 1. 获取a节点，添加onclick相应函数
        document.getElementsByTagName("a")[0].onclick = function () {

            // 3. 创建XMLHttpRequest对象
            var request = new XMLHttpRequest();

            // 4. 准备发送请求数据：url
            var url = this.href;
            var method = "get";

            // 5. 调用XMLHttpRequest对象的open方法
            request.open(method, url);

            // 6. 调用XMLHttpRequest对象的send方法
            request.send(null);

            /*
             * 7. 为XMLHttpRequest对象添加onreadystatechange相应函数，
             * 每个状态改变时都会触发这个事件处理器
             */
            request.onreadystatechange = function () {
                
                // 8. 判断相应是否完成（XMLHttpRequest对象的readyState属性为4时）
                if (request.readyState === 4) {
                    
                    // 9. 在判断相应值是否为200或304
                    if (request.status === 200 || request.readyState === 304) {

                        // 10. 打印相应结果responseTest
                        alert(request.responseText);
                    }
                    
                }
                
            };

            // 2. 取消a节点的默认行为
            return false;
        }
    }
</script>

<body>

<a href="hello.text">who?</a>

</body>
</html>
```

hello.text文件中保存了一句话：Hello Ajax!!

结果为![](pic/Snipaste_2019-03-19_16-32-14.png)

